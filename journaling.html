<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Journaling - Aura</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="journaling.css">
</head>
<body>
  <div class="container">
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="toggleTheme()">
      <span class="theme-icon">ğŸŒ™</span>
    </button>

    <div class="main-content">
      <!-- Header -->
      <div class="page-header">
        <button class="back-button" onclick="goBack()">â† Back to Home</button>
      </div>

      <div class="journaling-container">
        <div class="journaling-header">
          <h1 class="page-title"><span class="gradient-text">Personal Journaling</span></h1>
          <p class="page-subtitle">Express your thoughts and feelings freely in your private digital journal</p>
        </div>

        <!-- Journal Entry Form -->
        <div class="journal-form">
          <div class="form-card">
            <div class="form-header">
              <div class="journal-icon">ğŸ“–</div>
              <div class="entry-info">
                <h2 class="form-title">New Journal Entry</h2>
                <div class="entry-date" id="current-date"></div>
              </div>
            </div>

            <div class="form-content">
              <div class="title-section">
                <label for="journal-title" class="field-label">Entry Title</label>
                <input type="text" id="journal-title" class="title-input" placeholder="What's on your mind today?" maxlength="100">
                <div class="title-counter">0/100</div>
              </div>

              <div class="content-section">
                <label for="journal-content" class="field-label">Your Thoughts</label>
                <textarea id="journal-content" class="content-textarea" placeholder="Write freely about your day..." rows="12"></textarea>
                <div class="content-info">
                  <span class="privacy-note">ğŸ”’ Your journal entries are completely private</span>
                  <span class="word-count">0 words</span>
                </div>
              </div>

              <div class="mood-tag-section">
                <label class="field-label">How are you feeling?</label>
                <div class="mood-tags">
                  <button class="mood-tag" data-mood="grateful">ğŸ˜Š Grateful</button>
                  <button class="mood-tag" data-mood="peaceful">ğŸ˜Œ Peaceful</button>
                  <button class="mood-tag" data-mood="excited">ğŸ¤© Excited</button>
                  <button class="mood-tag" data-mood="thoughtful">ğŸ¤” Thoughtful</button>
                  <button class="mood-tag" data-mood="sad">ğŸ˜¢ Sad</button>
                  <button class="mood-tag" data-mood="anxious">ğŸ˜° Anxious</button>
                  <button class="mood-tag" data-mood="angry">ğŸ˜  Angry</button>
                  <button class="mood-tag" data-mood="confused">ğŸ˜• Confused</button>
                </div>
              </div>

              <div class="action-buttons">
                <button class="save-button" onclick="submitJournalEntry()"><span class="save-icon">ğŸ’¾</span>Save Entry</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Previous Entries -->
        <div class="previous-entries">
          <h3 class="entries-title">Previous Entries</h3>
          <div class="entries-list"><!-- Populated by JS --></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Set current date
    document.addEventListener('DOMContentLoaded', () => {
      const dateElement = document.getElementById('current-date');
      if (dateElement) {
        const now = new Date();
        dateElement.textContent = now.toLocaleString();
      }
    });

    // Character count
    const titleInput = document.getElementById('journal-title');
    const titleCounter = document.querySelector('.title-counter');
    if (titleInput && titleCounter) {
      titleInput.addEventListener('input', () => {
        const count = titleInput.value.length;
        titleCounter.textContent = `${count}/100`;
      });
    }

    const contentTextarea = document.getElementById('journal-content');
    const wordCount = document.querySelector('.word-count');
    if (contentTextarea && wordCount) {
      contentTextarea.addEventListener('input', () => {
        const words = contentTextarea.value.trim().split(/\s+/).filter(Boolean);
        wordCount.textContent = `${words.length} words`;
      });
    }

    // Mood tag selection
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('mood-tag')) {
        document.querySelectorAll('.mood-tag').forEach(tag => tag.classList.remove('selected'));
        e.target.classList.add('selected');
      }
    });

    // Submit entry
    async function submitJournalEntry() {
      const title = document.getElementById("journal-title").value;
      const content = document.getElementById("journal-content").value;
      const moodTag = document.querySelector(".mood-tag.selected");
      const mood = moodTag ? moodTag.dataset.mood : "unspecified";

      if (!content.trim()) {
        alert("Please write something before saving.");
        return;
      }

      await fetch("http://127.0.0.1:5000/add_entry", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, content, mood })
      });

      loadEntries();

      document.getElementById("journal-title").value = "";
      document.getElementById("journal-content").value = "";
      document.querySelectorAll(".mood-tag").forEach(tag => tag.classList.remove("selected"));
    }

    // Load entries
    async function loadEntries() {
      const res = await fetch("http://127.0.0.1:5000/get_entries");
      const entries = await res.json();

      const entriesList = document.querySelector(".entries-list");
      entriesList.innerHTML = "";

      if (entries.length === 0) {
        entriesList.innerHTML = "<p>No past entries yet. Start journaling!</p>";
        return;
      }

      entries.forEach(e => {
        const card = document.createElement("div");
        card.className = "entry-card";
        card.innerHTML = `
          <div class="entry-header">
            <div class="entry-title-prev">${e.title}</div>
            <div class="entry-date-prev">${e.timestamp}</div>
          </div>
          <div class="entry-preview">${e.content}</div>
          <div class="entry-mood">
            <span class="mood-indicator ${e.mood}">${e.mood}</span>
          </div>
        `;
        entriesList.appendChild(card);
      });
    }

    document.addEventListener("DOMContentLoaded", loadEntries);
  </script>
</body>
</html>
